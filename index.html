<!doctype html>
<html>

<head>

</head>

<body style="background-color:black;">

<div style="width:144px;width:144px;margin-left:auto;margin-right:auto;">
<canvas id="canvas" style="border:1px solid black;background-color:white;" width="144" height="144">It appears that your browser doesn't support the canvas element.</canvas>
</div>

<script>

"use strict";

var HIDDEN = 0;
var EMPTY = 1;
var BOMB = 2;
var EXPLODED = 3;
var FLAG = 4;
var ONE = 5;
var TWO = 6;
var THREE = 7;
var FOUR = 8;
var FIVE = 9;
var SIX = 10;

var x, y;
var squares = new Array(9);
for (x = 0; x < 9; x++) {
	squares[x] = new Array(9);
}
var guesses = new Array(9);
for (x = 0; x < 9; x++) {
	guesses[x] = new Array(9);
}

var i, j;
function isBomb(i, j) {
	// We don't want to check off the side of the grid
	if (i > -1 && i < 9 && j > -1 && j < 9) {
		if(squares[i][j] === BOMB) {
			return 1;
		} else {
			return 0;
		}
	} else {
		return 0;
	}
}

var canvas;
var context;
var sprite;
function drawField() {
	for (x = 0; x < 9; x++) {
		for (y = 0; y < 9; y++) {
			if(guesses[x][y] === 1) {
				context.drawImage(sprite, squares[x][y]*16, 0, 16, 16, x*16, y*16, 16, 16);
			} else {
				context.drawImage(sprite, 0*16, 0, 16, 16, x*16, y*16, 16, 16);
			}
		}
	}
}

function userClicked(evt) {
	var clickX, clickY;
	clickX = Math.floor((evt.pageX-canvas.offsetLeft)/16);
	clickY = Math.floor((evt.pageY-canvas.offsetTop)/16);
//	alert("userClicked " + Math.floor((evt.pageX-canvas.offsetLeft)/16) + ", " + Math.floor((event.pageY-canvas.offsetTop)/16));
	if(squares[clickX][clickY] === BOMB) {
		alert("THE END");
		for (x = 0; x < 9; x++) {
			for (y = 0; y < 9; y++) {
				guesses[clickX][clickY] = 1;
			}
		}
		squares[clickX][clickY] === EXPLODED;
	} else {
		guesses[clickX][clickY] = 1;
	}
	drawField();
}

function main() {
	canvas = document.getElementById('canvas');
	context = canvas.getContext('2d');

	canvas.addEventListener("click", userClicked, false);

	sprite = new Image();
	sprite.src = 'mines.png';

	for (x = 0; x < 9; x++) {
		for (y = 0; y < 9; y++) {
			squares[x][y] = EMPTY;
		}
	}

	// Generate bomb locations
	x = 0;
	while (x < 10) {
		var randomX = Math.floor(Math.random()*9);
		var randomY = Math.floor(Math.random()*9);
		if (squares[randomX][randomY] != BOMB) {
			squares[randomX][randomY] = BOMB;
			x++;
		}
	}

	// Generate neighbour counts
	for (x = 0; x < 9; x++) {
		for (y = 0; y < 9; y++) {
			if (squares[x][y] != BOMB) {
				var count = 0;
				count = count+isBomb( x-1 , y-1 );
				count = count+isBomb( x   , y-1 );
				count = count+isBomb( x+1 , y-1 );

				count = count+isBomb( x-1 , y   );
				count = count+isBomb( x+1 , y   );

				count = count+isBomb( x-1 , y+1 );
				count = count+isBomb( x   , y+1 );
				count = count+isBomb( x+1 , y+1 );
				if(count > 0)
					squares[x][y] = 4+count;
			}
		}
	}

	// Draw minefield
	sprite.onload = function() {
		drawField();
	}

}

main();

</script>

</body>

</html>